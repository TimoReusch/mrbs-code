# Database
## mrbs-DB authentication
!!! info ""
    Authentication method, usable on the Internet.

It works by storing the list of users in a new table called `mrbs_users` in the mrbs-database. The authentication is done by the class `\MRBS\Auth\AuthDb`. Enable it by setting `$auth["type"]="db"` in `config.inc.php`.

The list of users is displayed by clicking on the "Users" menu item in the top banner. This list is managed by module `edit_users.php`. 

- Administrators have the right to edit every entry, and add or remove users. 
- Ordinary users only have the right to edit their own entry.

When you first run MRBS, it will prompt you to set up a user with administrator rights. Until you do this, the system is open and the first person to use MRBS will be able to set up an administrator and lock you out of the system. You will then only be able to get back into the system by emptying the users table.

Once you have set up the first administrator you can then log on to the system using the username and password you have just created and create more users.

??? tip "Upgrading from pre-1.4.2 systems"

    Versions of MRBS before 1.4.2 did not store access rights in the database and relied on the list of admins in the config file. If you are upgrading from a pre-1.4.2 system, MRBS will automatically upgrade the users table in the database by adding a field for access rights level and give admin rights to those users for whom admin access is defined in the config-file. So, if upgrading, you will need to make sure that your admins are set in the config-file until you have run `edit_users.php` (by following the "User list" link) for the first time. Once you have run `edit_users.php`, the admin definitions in the config-file are no longer used and can be deleted if you wish.

It's possible, and very simple, to add new application-specific fields in the `mrbs_users`-table. No change is needed to the MRBS code. It will automatically detect the new fields and add columns for them. You can turn the field names into meaningful labels by using the `$vocab_override` config-setting, e.g.

```php-inline
$vocab_override['en']['address'] = 'Postal address';
```

!!! abstract "Future improvements"

    - Have a second level of administrators (level 3 users), with only such level 3 users allowed to edit the user database. This would be similar to all other authentications in mrbs, which delegate the user accounts management to an external authority.

## External DB (db_ext) Authentication
!!! info ""
    Authentication method, usable on the Internet.

    It works by using one of the installer's own databases. The database can be any database system for which MRBS has a database abstraction. You can configure how to connect to the database server, what kind of database system it is (mysql, mysqli, pgsql currently), the database/table to use, and the names of the "user" and "password" columns.

The configuration items are held in config.inc.php and are as follows:

```php-inline
// The server to connect to:
$auth['db_ext']['db_system'] = 'mysql'; /* Or 'mysqli', 'pgsql' */
$auth['db_ext']['db_host'] = 'localhost';

// MySQL username and password to connect with:
$auth['db_ext']['db_username'] = 'authuser';
$auth['db_ext']['db_password'] = 'authpass';

// Name of the database
$auth['db_ext']['db_name'] = 'authdb';

// Table that holds the authentication data
$auth['db_ext']['db_table'] = 'users';

// Names of the two columns, that hold the authentication data
$auth['db_ext']['column_name_username'] = 'name';
$auth['db_ext']['column_name_password'] = 'password';

// This is the format of the password entries in the table. 
// You can specify 'md5', 'sha1', 'sha256', 'crypt' or 'plaintext'.
$auth['db_ext']['password_format'] = 'md5';

// Optional; contains the name of the column that holds the access level of the user
$auth['db_ext']['column_name_level'] = 'level';
```